<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="Scripts/jquery-1.9.1.min.js" type="text/javascript"></script>

    <script src="Scripts/json2.js" type="text/javascript"></script>
    <script src="Scripts/jquery.my.webapi.js" type="text/javascript"></script>
    <script src="Scripts/jquery.kansa.Query.js" type="text/javascript"></script>
    <script src="debug/jquery.my.debug.js" type="text/javascript"></script>

    <!-- menu -->
    <script src="Scripts/jquery.my.frame.js" type="text/javascript"></script>
    <!-- menu -->
    <link href="Scripts/my.mnmenu.css" rel="stylesheet" type="text/css" />
    <script src="Scripts/jquery.my.mymenu.js" type="text/javascript"></script>
    <script src="Scripts/jquery.my.mnmenu.js" type="text/javascript"></script>

    <!-- fileOut -->
    <script src="debug/jquery.my.fileOut.js" type="text/javascript"></script>
    <script type="text/javascript">
        (function ($) {
        })(jQuery);
    </script>

    <script type="text/javascript">
        var debug_mode = false;
    </script>

    <script type="text/javascript">
        $(window).on("load", function () {
            try {
                var args = Array.prototype.slice.call(arguments, 1);
                if (window.location.search.split('?').length > 0) {
                    var arg = window.location.search.split('?').slice(1);
                    if (arg == "debug=1") debug_mode = true;
                }
                $.debug("Start Menu");


                // EntryTab テーブルの取得
                //var methodList2 = $.loadXMLDoc("menu2.xml");
                var methodList = $.WebApi();

                // methodList(xml,json)の取得
                var methodList2 = $.WebApi_test("xml");

                // menu データの取得
                var menu_data = $.loadXMLDoc("menu.xml");

                menu_Xml = menuData_Join(menu_data, methodList, methodList2);

                $(".menuBlock_content").mymenu(menu_Xml, {
                    color_menu_base: "cornflowerblue",
                    color_menu_select: "royalblue",
                    click: menu_click,
                    context_menu: menu_click2,
                    mouse_enter: mouse_enter
                });
                if( debug_mode ) $(".level-0[title='debug']").css("display", "inline");

                $("iframe.iframe_content").frame();

            } catch (e) {
                alert(e.message);
            }
        });
        $(function () {

        });

        function menuData_Join(menu_xml, methodList, methodList2) {
            var xml_menus = $(methodList).find("root>xml>menu");
            var xml_methodTop = $(menu_xml).find("menu[name='テーブル(XML)']");
            xml_methodTop.prepend(xml_menus);

            var json_menus = $(methodList).find("root>json>menu");
            var json_methodTop = $(menu_xml).find("menu[name='テーブル(JSON)']");
            json_methodTop.prepend(json_menus);

            var sample_menus = $(methodList).find("root>sample>menu");
            var sample_methodTop = $(menu_xml).find("menu[name='テーブル(sample)']");
            sample_methodTop.prepend(sample_menus);

            var test_json_menus = $(methodList2).find("root>json>menu");
            var test_json_methodTop = $(menu_xml).find("menu[name='関数(TEST_JSON)']");
            test_json_methodTop.prepend(test_json_menus);

            var test_xml_menus = $(methodList2).find("root>xml>menu");
            var test_xml_methodTop = $(menu_xml).find("menu[name='関数(TEST_XML)']");
            test_xml_methodTop.prepend(test_xml_menus);

            return (menu_xml);
        }
    </script>
    <script>
        $(function () {
            $(window).on("resize", function () {
                var a = 1;
            });
            $("li").on("mouseenter", function () {
                $.debug("AA");
            })
        });

    </script>
    <script type="text/javascript">
        function mouse_enter(o) {
            $(o)[0].setAttribute("title", $(o).data().item);
        }
        function menu_click2(o) {
            var Json = {};
            try {
                Json = $.WebApi_json(o.item);
            } catch (e) {
                $.debug("error", e.message);
                Json = {
                    error: e.message,
                    url: o.item
                };
            }
            var Str = JSON.stringify(Json);
            $.storage("viewStr", Str);
            $("iframe.iframe_content").attr("src", "Util/viewValue.html");
            return (false);
        }
        function menu_click(o) {
            var mode = o.mode;          // method,url,undefined
            if (mode == "url" || mode == "method") {
                menu_click_test(o);
                return;
            }
            // ここでxml/json分ける
            if (o.table == "xml") {
                $.debug("click_xml", mode, o.item);
                var xmlDoc = $.WebApi(o.item, o.option);
                var Str = $.xml2str(xmlDoc);
                //$.fileOut(o.item, Str);
            }
            else {
                $.debug("click_json", mode, o.item);
                var json = $.WebApi_json(o.item, o.option);
                var Str = JSON.stringify(json);
            }
            //StrOut(Str);
            $.storage("viewStr", Str);
            $("iframe.iframe_content").attr("src", "Util/viewValue.html");
        }

        function menu_click_test(o) {
            var mode = o.mode;
            if (mode == "method") {
                //$.debug("click_test", mode, o.item + "/" + o.func);
                var type = o.type;
                var option = (typeof(o.option) == "undefined" ? "" : o.option);
                var value = o.item + "/" + o.func;
                if (type == "xml") {
                    //$.debug("click_test_xml", mode, o.item + "/" + o.func,option);
                    var xmlDoc = $.WebApi_test("xml", o.item, o.func, option);
                    var Str = $.xml2str(xmlDoc);
                    //StrOut(Str);
                    $.storage("viewStr", Str);
                    $("iframe.iframe_content").attr("src", "Util/viewValue.html");
                }
                else if (type == "json") {
                    //$.debug("click_test_json", mode, o.item + "/" + o.func,option);
                    var Str = $.WebApi_test("json", o.item, o.func, option);
                    //$.alert.json(Str);
                    //$.storage("viewStr", JSON.stringify(Str, null, 2));
                    $.storage("viewStr", Str);
                    $("iframe.iframe_content").attr("src", "Util/viewValue.html");
                }
                else {
                }
            }
            else if (mode == "url") {
                var url = o.url + "?TimeSpan=" + Number(new Date());
                $.debug("click", mode, url);
                $("iframe.iframe_content").attr("src", url);
            }
        }

        function isJSON(arg) {
            arg = (typeof arg === "function") ? arg() : arg;
            if (typeof arg !== "string") {
                return false;
            }
            try {
                arg = (!JSON) ? eval("(" + arg + ")") : JSON.parse(arg);
                return true;
            } catch (e) {
                return false;
            }
        };
    </script>
    <script type="text/javascript">
        $(function () {
        });
        function StrOut(xmlStr) {
            if ($.isJSON(xmlStr)) {
                var work = JSON.stringify(xmlStr, null, 2);
                $.alert("結果【JSON】", work);
            }
            else {
                var xmlDoc = $.str2xml(xmlStr);
                var err = $(xmlDoc).selectSingleNode("error");
                if (err != null && err.childNodes.length > 0) {
                    $.alert("＝＝　エラー　＝＝", err.childNodes[0].text);
                }
                else {
                    $.alert("結果【XML】", xmlStr);
                    var a = 1;
                    //$("data", xmlStr).each(function (i, elem) {
                    //    //$.debug(elem.id, $(elem).attr("class"), $(elem).text());
                    //    var a = 1;
                    //})
                }
            }
        }

    </script>
    <style>
        body {
            *font-family: Arial;
            overflow: hidden;
            padding: 0;
            border: 0px solid green;
            margin: 0px 0px 0px 0px;
            background-color: snow;
        }

        .iframe_content {
            vertical-align: top;
            width: 100%;
            *height: 100%;
            border: 1px solid green;
            background-color: snow;
        }

        .menuBlock_X {
            background-color: cornflowerblue;
            width: 100%;
            white-space: nowrap;
            border: 0px solid red;
            padding: 0;
        }

        .logoBase {
            background-color: cornflowerblue;
            width: 1%;
            border: 0px solid red;
            height: 32px;
        }

        .menuBase {
            width: 90%;
            vertical-align: middle;
        }

        .topBar {
            background-color: cornflowerblue;
            border-collapse: collapse;
            width: 100%;
            white-space: nowrap;
            padding: 0;
            border: 0px solid red;
        }

        .EMG_Logo {
            height: 30px;
            vertical-align: middle;
        }

        .EMG_Logo-toggle {
            height: 30px;
            vertical-align: middle;
            opacity: 0.6;
            *transform: translateX(10.0rem);
        }
    </style>

</head>
<body>
    <div class="drawer">
        <main role="main">
            <div class="menuBlock">
                <table class="topBar">
                    <tr>
                        <td class="logoBase drawer-toggle">
                            <img class="EMG_Logo" src="images/EM.png" />
                        </td>
                        <td class="menuBase">
                            <div class="menuBlock_content"></div>
                        </td>
                    </tr>
                </table>
            </div>
        </main>
    </div>
    <iframe class="iframe_content"></iframe>
</body>


</html>
